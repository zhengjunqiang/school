# 嵌入式操作系统及应用（第24号教案）
|课程名称|嵌入式操作系统及应用|嵌入式操作系统及应用|授课日期||
|---|---|---|---|---|
|班    级|物联网2411|物联网2412|物联网2411|物联网2412|课堂类型|一体化|
|教    材|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|
|章节名称|案例开发：i2c扫描从设备|案例开发：i2c扫描从设备|案例开发：i2c扫描从设备|案例开发：i2c扫描从设备|
|目的要求|1. 知识目标：掌握I2C总线初始化流程（`I2cIoInit()`、`LzI2cInit()`、`PinctrlSet()`）及从设备扫描函数（`LzI2cScan()`）的调用方法；理解GPIO引脚复用为I2C功能的原理；熟悉`BUILD.gn`与`Makefile`的编译配置修改。<br>2. 能力目标：能独立完成RK2206开发板I2C初始化与从设备扫描代码编写、编译烧录；能通过串口助手查看扫描结果，排查引脚复用、总线速率配置类基础问题。<br>3. 素养目标：结合OpenHarmony在I2C外设开发中的应用，强化国产操作系统技术认同感，培养嵌入式开发中“硬件-软件协同”的严谨思维。|
|学情分析|1. 基础：学生已掌握OpenHarmony基础操作、C语言编程及简单API调用逻辑，了解开发板串口查看与编译配置基础，具备初步嵌入式硬件外设实操能力。<br>2. 薄弱点：对I2C总线通信原理（如主从设备交互逻辑）理解较浅；对GPIO引脚复用配置（`PinctrlSet()`参数含义）、I2C总线速率设置与扫描结果的关联逻辑不熟悉，需重点拆解。|
|重 难 点 分    析|1. 重点：<br> - I2C初始化三步法（总线初始化`I2cIoInit()`、速率配置`LzI2cInit()`、引脚复用`PinctrlSet()`）；<br> - 从设备扫描函数`LzI2cScan()`的调用（参数传递、扫描地址范围0x03-0x87、结果数组存储）；<br> - 编译配置修改（`BUILD.gn`指定`i2c_scan_example`参与编译、`Makefile`添加链接库`-li2c_scan_example`）。<br>2. 难点：<br> - `PinctrlSet()`函数参数理解（如`GPIO0_PA0`/`GPIO0_PA1`引脚、`MUX_FUNC3`复用功能、`PULL_KEEP`电平保持）；<br> - I2C总线速率（如常见100kHz/400kHz）对扫描稳定性的影响；<br> - 扫描结果异常（如无设备地址显示）的排查（硬件接线、引脚配置、总线初始化顺序）。|
|信息化应用方法|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|
|思政元素 融合设计|思政元素|融入方式|融入方式|融入方式|
|民族自豪感、科技报国情怀|1. 讲解OpenHarmony在智能硬件（如智慧车载、传感器模块）I2C外设开发中的应用案例，对比国外操作系统，强调国产系统的开源优势与适配性，强化民族自豪感；<br>2. 结合I2C技术在工业控制、消费电子等领域的重要性，引导学生认识嵌入式技术对国家科技发展的支撑作用，树立科技报国情怀。|1. 讲解OpenHarmony在智能硬件（如智慧车载、传感器模块）I2C外设开发中的应用案例，对比国外操作系统，强调国产系统的开源优势与适配性，强化民族自豪感；<br>2. 结合I2C技术在工业控制、消费电子等领域的重要性，引导学生认识嵌入式技术对国家科技发展的支撑作用，树立科技报国情怀。|1. 讲解OpenHarmony在智能硬件（如智慧车载、传感器模块）I2C外设开发中的应用案例，对比国外操作系统，强调国产系统的开源优势与适配性，强化民族自豪感；<br>2. 结合I2C技术在工业控制、消费电子等领域的重要性，引导学生认识嵌入式技术对国家科技发展的支撑作用，树立科技报国情怀。|
|作业布置|1. 线上练习：完成学习通中“I2C扫描从设备”相关选择题（含初始化函数、引脚配置、编译配置考点）；<br>2. 线下实践：修改示例代码，将I2C总线速率调整为400kHz（原速率默认100kHz），连接智慧车载模块后重新扫描，对比不同速率下的扫描结果，将代码与串口日志截图上传至学习平台；<br>3. 拓展思考：查阅资料，分析I2C总线“主从通信”与“SPI通信”的核心区别，撰写100字以内小结。|
|参考资料|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 开发板I2C接口文档：/device/rockchip/hardware/docs/I2C.md|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 开发板I2C接口文档：/device/rockchip/hardware/docs/I2C.md|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 开发板I2C接口文档：/device/rockchip/hardware/docs/I2C.md|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 开发板I2C接口文档：/device/rockchip/hardware/docs/I2C.md|


|教学环节|教学内容|教师活动|学生活动|设计意图|
|---|---|---|---|---|
|课前|预习（30分钟）|1. 在学习平台上传预习视频（含I2C总线基础概念、RK2206 I2C引脚分布、`LzI2cScan()`函数简介）；<br>2. 布置预习任务：回顾`BUILD.gn`文件修改逻辑，思考“为何I2C初始化需要先配置引脚复用”。|1. 观看预习视频，记录疑问（如“I2C主从设备如何通信”）；<br>2. 复习编译配置知识，完成预习思考题。|提前铺垫I2C硬件与软件基础，减少课堂理解障碍，为实操环节打基础。|
|课中|课程介绍（5min）|1. 明确本节课目标：完成RK2206开发板I2C初始化，实现对从设备（智慧车载模块）的地址扫描，通过串口查看扫描结果；<br>2. 结合OpenHarmony在智慧车载I2C设备适配中的案例，强调国产系统的技术价值，融入思政元素。|1. 记录课堂目标，明确学习重点；<br>2. 聆听应用案例，建立对I2C扫描实际意义的认知。|让学生清晰学习方向，以实际场景激发学习兴趣，强化民族自豪感。|
||任务导入（10min）|1. 现场演示：<br> - 连接智慧车载模块与开发板，烧录代码后按下RESET键；<br> - 打开串口助手，展示“扫描出从设备地址0x56、0x76”的日志效果；<br>2. 拆解核心任务：硬件接线→I2C初始化代码编写→扫描函数调用→编译烧录→串口验证；<br>3. 强调关键提醒：智慧车载模块需正确接线，否则无法扫描到设备。|1. 观察演示效果，理解任务需求；<br>2. 记录任务拆解步骤，标记硬件接线要点。|通过直观演示降低任务复杂度，以“步骤拆解+硬件提醒”帮助学生规避基础错误。|
||知识储备（15min）|1. 讲解核心知识点：<br> - I2C总线原理：用“主设备提问、从设备应答”类比，简化主从通信逻辑，说明扫描地址范围（0x03-0x87）的原因；<br> - 初始化函数详解：<br>   - `I2cIoInit(m_i2cBus)`：初始化指定I2C总线（如I2C_BUS=0）；<br>   - `LzI2cInit(I2C_BUS, m_i2c_freq)`：设置总线速率（默认100kHz）；<br>   - `PinctrlSet(...)`：解释`GPIO0_PA0`/`GPIO0_PA1`引脚、`MUX_FUNC3`（I2C功能复用）、`PULL_KEEP`（保持引脚电平稳定）的含义；<br>2. 互动提问：“若跳过`PinctrlSet()`函数，I2C初始化会成功吗？为什么？”，引导学生关注硬件配置必要性。|1. 记录函数用法与参数含义，结合类比理解I2C通信；<br>2. 参与互动，分析硬件配置对初始化的影响。|聚焦I2C初始化核心逻辑，通过类比简化原理理解，通过提问强化“硬件-软件协同”思维。|
||任务导入（5min）|1. 针对扫描函数补充提问：“`LzI2cScan()`的返回值是什么？如何通过返回值获取扫描到的从设备数量？”；<br>2. 明确后续重点：讲解扫描结果数组（`slaveAddr`）的使用，以及串口打印地址的代码逻辑（`printf("slave address: 0x%02x\n", slaveAddr[i])`）。|1. 思考并回答提问，理解扫描函数返回值意义；<br>2. 记录扫描结果处理的代码要点。|通过提问衔接前序知识，聚焦扫描结果解析逻辑，为代码编写铺垫。|
||知识储备（10min）|1. 代码逻辑拆解：<br> - 完整代码结构：包含头文件引入（如`#include "lz_i2c.h"`）、全局变量定义（`m_i2cBus`、`m_i2c_freq`）、初始化函数调用、扫描函数调用、结果打印；<br> - 关键代码标注：在`LzI2cScan()`函数处强调“传入总线号、结果数组、数组最大长度”的参数要求；<br>2. 用“点名”类比`LzI2cScan()`：主设备（开发板）按地址（0x03-0x87）依次“点名”，有应答的从设备（智慧车载模块）地址被记录。|1. 分析代码结构，标注关键函数与参数；<br>2. 结合“点名”类比，理解扫描逻辑。|用通俗类比降低扫描函数理解难度，通过代码拆解帮助学生掌握编写思路。|
||任务实施（40min）|1. 现场指导：<br> - 硬件接线指导：演示智慧车载模块与开发板I2C引脚（SDA/GPIO0_PA0、SCL/GPIO0_PA1）的正确连接；<br> - 软件实操辅导：巡视学生代码编写（如初始化函数顺序、扫描结果打印），针对共性问题（如头文件缺失、引脚号写错）集中讲解；<br> - 问题排查：对“无扫描结果”的学生，协助检查接线、代码初始化顺序、串口波特率；<br>2. 阶段性检查：每完成一个步骤（接线、代码编写、编译烧录），随机抽查进度，确保无学生掉队。|1. 按步骤实操：<br> - 连接智慧车载模块与开发板；<br> - 编写`i2c_scan_example.c`代码（含初始化、扫描、结果打印）；<br> - 修改`BUILD.gn`与`Makefile`，编译烧录后通过串口查看结果；<br>2. 自主排查简单问题（如代码语法错误），复杂问题举手提问。|通过“硬件+软件”双维度指导，提升学生实操与问题解决能力，确保核心任务落地。|
||任务总结（5min）|1. 成果验证：随机邀请2-3名学生展示串口日志，确认“扫描到0x56、0x76地址”的功能实现；<br>2. 问题总结：梳理课堂共性问题（如接线反接、`m_i2cBus`赋值错误、编译链接库缺失），强调注意事项；<br>3. 检查工单：确认所有学生提交“任务实施工单”（含接线照片、代码截图、串口日志截图）。|1. 展示实操成果，分享问题解决方法（如接线错误的排查）；<br>2. 记录共性问题，补充笔记；<br>3. 提交任务工单，确认成果符合要求。|通过成果展示强化成就感，以问题总结巩固知识点，工单检查确保任务完成质量。|
|作业|学习通练习+实践任务|1. 在学习平台发布作业：线上选择题（10题，含初始化函数、引脚配置考点）+ 线下实践任务（调整I2C速率并对比结果）；<br>2. 提示：线下任务需在3天内上传，教师将批改并反馈拓展思考。|1. 完成线上练习，查看错题解析；<br>2. 开展线下实践，修改代码、对比结果并撰写拓展思考，按时上传。|通过“线上+线下”作业巩固课堂知识，拓展思考提升自主学习与技术分析能力。|
|课后|资源上传与复习|1. 将课堂PPT、实验指导书（含接线图、代码模板、常见问题排查手册）、I2C接口文档上传至学习平台；<br>2. 汇总学生电子学习档案（含预习情况、工单提交、作业成果），标记需重点辅导的学生；<br>3. 发布复习提示：重点回顾I2C初始化顺序与`LzI2cScan()`函数参数。|1. 登录学习平台下载资源，对照笔记补全知识点；<br>2. 查看学习档案，针对薄弱环节（如引脚配置）重点复习；<br>3. 遇到问题可在平台留言提问。|提供全面复习资源，帮助学生查缺补漏，通过档案汇总实现个性化辅导铺垫。|