# 嵌入式操作系统及应用（第23号教案）
|课程名称|嵌入式操作系统及应用|嵌入式操作系统及应用|授课日期||
|---|---|---|---|---|
|班    级|物联网2411|物联网2412|物联网2411|物联网2412|课堂类型|一体化|
|教    材|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|
|章节名称|案例开发：WiFi路由模式|案例开发：WiFi路由模式|案例开发：WiFi路由模式|案例开发：WiFi路由模式|
|目的要求|1. 知识目标：掌握WiFi-AP模式核心API（`FlashInit()`、`VendorSet()`、`SetApModeOn()`等）的调用方法、头文件依赖及参数要求；理解TCP服务端创建流程（`socket()`、`bind()`、`listen()`等函数）；熟悉`BUILD.gn`与`Makefile`的编译配置修改。<br>2. 能力目标：能独立完成RK2206开发板WiFi-AP模式配置与TCP通信代码编写、编译烧录；能通过串口助手查看运行日志，排查参数配置、网络连接类基础问题。<br>3. 素养目标：结合OpenHarmony在物联网网络通信中的应用，强化国产操作系统技术认同感，培养工程实践中的严谨思维。|
|学情分析|1. 基础：学生已掌握OpenHarmony基础操作、C语言编程及简单函数调用逻辑，了解开发板串口查看方法，具备初步嵌入式软件实操能力。<br>2. 薄弱点：对网络通信相关API（如`VendorSet()`参数匹配、TCP函数调用顺序）理解易混淆；对编译配置文件（`BUILD.gn`、`Makefile`）修改与功能生效的关联逻辑不熟悉，需重点引导。|
|重 难 点 分    析|1. 重点：<br> - WiFi-AP模式参数配置（SSID、密码、MAC地址、模式标识）与Flash写入（`FlashInit()`初始化后调用`VendorSet()`）；<br> - TCP服务端创建（`socket()`创建、`bind()`绑定、`listen()`监听、`accept()`接收连接）；<br> - 编译配置修改（`BUILD.gn`指定`wifi_ap_example`参与编译、`Makefile`添加链接库`-lwifi_ap_example`）。<br>2. 难点：<br> - `VendorSet()`函数参数匹配（如`VENDOR_ID_WIFI_MODE`对应“AP”字符串且长度严格限制为4字节）；<br> - TCP通信中网络字节序转换（`htonl()`、`htons()`）与阻塞式函数（`recv()`）的理解；<br> - WiFi-AP模式“先关后开”（`SetApModeOff()`→`SetApModeOn()`）与参数生效的关联逻辑。|
|信息化应用方法|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|
|思政元素 融合设计|思政元素|融入方式|融入方式|融入方式|
|技术认同感、严谨思维|1. 讲解OpenHarmony在物联网设备网络通信中的实际应用案例（如智能设备局域网通信），强调国产操作系统的技术优势，强化技术认同感；<br>2. 针对API参数长度限制、编译配置顺序等细节，强调工程实践中“严谨性”的重要性，培养学生严谨思维。|1. 讲解OpenHarmony在物联网设备网络通信中的实际应用案例（如智能设备局域网通信），强调国产操作系统的技术优势，强化技术认同感；<br>2. 针对API参数长度限制、编译配置顺序等细节，强调工程实践中“严谨性”的重要性，培养学生严谨思维。|1. 讲解OpenHarmony在物联网设备网络通信中的实际应用案例（如智能设备局域网通信），强调国产操作系统的技术优势，强化技术认同感；<br>2. 针对API参数长度限制、编译配置顺序等细节，强调工程实践中“严谨性”的重要性，培养学生严谨思维。|
|作业布置|1. 线上练习：完成学习通中“WiFi-AP模式与TCP通信”相关选择题（含API参数、编译配置考点）；<br>2. 线下实践：修改示例代码，将WiFi-AP模式的SSID改为“OH_RK2206_自定义学号”、密码改为“12345678”，并实现“PC端发送指令后开发板回复自定义消息”功能，将代码与串口日志截图上传至学习平台；<br>3. 拓展思考：查阅资料，分析“WiFi-AP模式”与“WiFi-STA模式”的核心区别，撰写100字以内小结。|
|参考资料|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git|


|教学环节|教学内容|教师活动|学生活动|设计意图|
|---|---|---|---|---|
|课前|预习（30分钟）|1. 在学习平台上传预习视频（含WiFi-AP模式概念、核心API简介、TCP通信基础流程）；<br>2. 布置预习任务：回顾`BUILD.gn`文件结构，思考“为何调用`VendorSet()`前需先执行`FlashInit()`”。|1. 观看预习视频，记录疑问（如“TCP服务端函数调用顺序”）；<br>2. 复习`BUILD.gn`相关知识，完成预习思考题。|提前铺垫网络通信与API基础，减少课堂理解障碍，为实操环节打基础。|
|课中|课程介绍（5min）|1. 明确本节课目标：完成RK2206开发板WiFi-AP模式配置，实现与PC端的TCP通信（PC端发送消息，开发板接收并回复）；<br>2. 结合OpenHarmony在智能家电局域网通信中的应用案例，强调国产系统的实用性，融入思政元素。|1. 记录课堂目标，明确学习重点；<br>2. 聆听应用案例，建立对WiFi-AP模式实际价值的认知。|让学生清晰学习方向，以实际案例激发学习兴趣，强化技术认同感。|
||任务导入（10min）|1. 现场演示：烧录好代码的开发板开启WiFi-AP模式，PC端连接该WiFi后通过网络工具与开发板建立TCP通信，展示“PC发消息、开发板回复”的日志效果；<br>2. 拆解核心任务：参数配置→Flash写入→AP模式启停→TCP服务端开发→编译烧录→通信验证；<br>3. 强调任务关键节点：API参数长度限制、TCP函数调用顺序。|1. 观察演示效果，理解任务需求；<br>2. 记录任务拆解步骤，标记关键节点。|通过直观演示降低任务复杂度，以“步骤拆解”帮助学生建立清晰的实施逻辑。|
||知识储备（15min）|1. 讲解核心API：<br> - `FlashInit()`：头文件路径（`//device/rockchip/rk2206/adapter/include/lz_hadware.h`），作用是初始化Flash，为`VendorSet()`铺路；<br> - `VendorSet()`：参数要求（如`VENDOR_ID_WIFI_MODE`对应“AP”字符串，长度4字节）、头文件依赖（`vendor.h`）；<br> - `SetApModeOn()`/`SetApModeOff()`：头文件路径（`//device/rockchip/rk2206/sdk_liteos/board/include/config_network.h`），作用是启停AP模式；<br>2. 互动提问：“若`VendorSet()`中`wifi_mode`字符串长度为5字节，会导致什么问题？”，引导学生关注参数严谨性。|1. 记录API用法、头文件路径及参数限制；<br>2. 参与互动，分析参数错误的影响。|聚焦API核心知识点，通过提问强化“参数严谨性”认知，规避实操错误。|
||任务导入（5min）|1. 针对编译配置补充提问：“修改`BUILD.gn`时，如何指定`wifi_ap_example`参与编译？不修改会导致什么问题？”；<br>2. 明确后续重点：讲解`Makefile`添加链接库`-lwifi_ap_example`的方法，强调“缺失链接库会导致编译失败”。|1. 思考并回答提问，回忆编译配置文件作用；<br>2. 记录`BUILD.gn`与`Makefile`的修改要点。|通过提问衔接前序知识，聚焦编译配置易错点，提前规避实操问题。|
||知识储备（10min）|1. 软件设计逻辑分析：<br> - WiFi-AP模式配置：“参数定义→Flash写入→模式重启”三步法，结合代码示例讲解`wifi_process()`函数中`memset()`初始化、`snprintf()`赋值的逻辑；<br> - TCP服务端：以“创建-绑定-监听-接收-通信”流程，讲解`wifi_tcp_server()`函数中`socket()`、`bind()`等函数的调用顺序，以及`htonl()`转换网络字节序的作用；<br>2. 用“打电话”类比TCP通信（拨号=创建socket，占线=绑定端口，等待接听=监听，接通=接收连接），简化理解。|1. 结合类比理解TCP流程，标注代码中关键函数；<br>2. 记录软件设计的核心步骤。|用通俗类比降低网络通信逻辑理解难度，通过代码分析帮助学生掌握实操核心。|
||任务实施（40min）|1. 现场指导：<br> - 巡视学生实操，针对共性问题（如`VendorSet()`参数长度错误、`BUILD.gn`路径写错）集中讲解；<br> - 对代码报错（如“socket创建失败”）、通信无响应的学生，一对一排查（如WiFi未连接、端口号不匹配）；<br>2. 阶段性检查：每完成一个步骤（参数配置、编译、通信验证），随机抽查学生进度，确保无学生掉队。|1. 按步骤实操：<br> - 编写`wifi_ap_example.c`代码（含`wifi_process()`、`wifi_tcp_server()`函数）；<br> - 修改`BUILD.gn`与`Makefile`，编译烧录代码；<br> - PC端连接开发板WiFi，通过网络工具建立TCP通信，查看日志；<br>2. 自主排查简单问题，复杂问题举手提问。|通过“实操+指导”提升学生软件应用与问题解决能力，确保核心任务落地。|
||任务总结（5min）|1. 成果验证：随机邀请2-3名学生展示TCP通信日志，确认“PC发消息、开发板回复”功能实现；<br>2. 问题总结：梳理课堂共性问题（如`VENDOR_ID`参数写错、TCP端口号不匹配），强调注意事项；<br>3. 检查工单：确认所有学生提交“任务实施工单”（含代码截图、串口日志截图）。|1. 展示实操成果，分享问题解决方法；<br>2. 记录共性问题，补充笔记；<br>3. 提交任务工单，确认成果符合要求。|通过成果展示强化成就感，以问题总结巩固知识点，工单检查确保任务完成质量。|
|作业|学习通练习+实践任务|1. 在学习平台发布作业：线上选择题（10题，含API参数、编译配置考点）+ 线下实践任务（修改SSID/密码、自定义回复消息）；<br>2. 提示：线下任务需在3天内上传，教师将在平台批改并反馈拓展思考。|1. 完成线上练习，查看错题解析；<br>2. 开展线下实践，修改代码并撰写拓展思考，按时上传。|通过“线上+线下”作业巩固课堂知识，拓展思考提升自主学习与分析能力。|
|课后|资源上传与复习|1. 将课堂PPT、实验指导书（含代码模板、编译步骤细节、常见问题排查手册）上传至学习平台；<br>2. 汇总学生电子学习档案（含预习情况、工单提交、作业成果），标记需重点辅导的学生；<br>3. 发布复习提示：重点回顾WiFi-AP模式配置步骤与TCP函数调用顺序。|1. 登录学习平台下载资源，对照笔记补全知识点；<br>2. 查看学习档案，针对薄弱环节（如TCP通信）重点复习；<br>3. 遇到问题可在平台留言提问。|提供全面复习资源，帮助学生查缺补漏，通过档案汇总实现个性化辅导铺垫。|