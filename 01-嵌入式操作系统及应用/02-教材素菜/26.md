# 嵌入式操作系统及应用（第26号教案）
|课程名称|嵌入式操作系统及应用|嵌入式操作系统及应用|授课日期||
|---|---|---|---|---|
|班    级|物联网2411|物联网2412|物联网2411|物联网2412|课堂类型|一体化|
|教    材|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|
|章节名称|案例开发：基于华为云IoT的智慧井盖|案例开发：基于华为云IoT的智慧井盖|案例开发：基于华为云IoT的智慧井盖|案例开发：基于华为云IoT的智慧井盖|
|目的要求|1. 知识目标：掌握华为云IoT平台设备接入流程（产品创建、设备注册、连接信息生成）；理解智慧井盖模块数据采集（X/Y/Z轴加速度）与倾斜告警逻辑；熟悉核心API（`device_info_init()`、`oc_mqtt_init()`、`oc_mqtt_profile_propertyreport()`）的调用与参数配置。<br>2. 能力目标：能独立完成华为云IoT平台配置、RK2206开发板WiFi连接与智慧井盖数据上报；能通过串口助手与华为云平台查看数据，排查网络冲突、设备认证类问题。<br>3. 素养目标：结合OpenHarmony与华为云的国产技术协同应用，强化民族自豪感；通过智慧井盖在城市安防中的实际价值，引导学生树立科技报国与服务社会的情怀。|
|学情分析|1. 基础：学生已掌握MQTT协议基础、WiFi连接与编译配置逻辑，了解嵌入式线程与消息队列的基本使用，具备初步物联网云平台开发认知。<br>2. 薄弱点：对华为云IoT平台产品模型定义（服务ID、属性配置）与代码参数的匹配逻辑不熟悉；对消息队列（`LOS_QueueCreate()`/`LOS_QueueRead()`）在多线程数据传递中的作用理解较浅；对MAC地址冲突导致的WiFi连接失败缺乏排查经验，需重点引导。|
|重 难 点 分    析|1. 重点：<br> - 华为云IoT平台配置（产品创建时“智慧井盖”服务ID与属性定义、设备注册时密钥认证、连接信息生成）；<br> - 智慧井盖模块开发全流程（WiFi连接→设备信息初始化→MQTT客户端初始化→数据采集与上报）；<br> - 核心API调用（`device_info_init()`配置ClientId/Username/Password、`oc_mqtt_profile_propertyreport()`上报加速度与告警数据）。<br>2. 难点：<br> - 华为云连接信息（ClientId/Username/Password）与代码参数的精准匹配（ mismatch会导致认证失败）；<br> - 多线程协同逻辑（`e53_sc_thread`采集数据→消息队列传递→`iot_cloud_sc_thread`上报云平台）；<br> - 异常排查（MAC地址冲突导致WiFi连不上、华为云属性格式不匹配导致数据上报失败）。|
|信息化应用方法|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|
|思政元素 融合设计|思政元素|融入方式|融入方式|融入方式|
|民族自豪感、科技报国情怀|1. 讲解OpenHarmony与华为云的国产技术协同优势（轻量系统适配云端服务，降低物联网设备开发门槛），对比国外云平台与系统组合，强调国产技术对智慧城市建设的支撑作用，强化民族自豪感；<br>2. 结合智慧井盖在城市排水防涝、道路安全中的应用案例，引导学生认识嵌入式技术的社会价值，树立“科技服务民生、技术报国”的情怀。|1. 讲解OpenHarmony与华为云的国产技术协同优势（轻量系统适配云端服务，降低物联网设备开发门槛），对比国外云平台与系统组合，强调国产技术对智慧城市建设的支撑作用，强化民族自豪感；<br>2. 结合智慧井盖在城市排水防涝、道路安全中的应用案例，引导学生认识嵌入式技术的社会价值，树立“科技服务民生、技术报国”的情怀。|1. 讲解OpenHarmony与华为云的国产技术协同优势（轻量系统适配云端服务，降低物联网设备开发门槛），对比国外云平台与系统组合，强调国产技术对智慧城市建设的支撑作用，强化民族自豪感；<br>2. 结合智慧井盖在城市排水防涝、道路安全中的应用案例，引导学生认识嵌入式技术的社会价值，树立“科技服务民生、技术报国”的情怀。|
|作业布置|1. 线上练习：完成学习通中“华为云IoT智慧井盖”相关选择题（含云平台配置、API参数、多线程考点）；<br>2. 线下实践：修改示例代码，将数据上报周期从2秒改为5秒，新增“电池电量”模拟属性（固定值90%）并在华为云添加对应属性，将代码、串口日志与华为云数据截图上传至学习平台；<br>3. 拓展思考：查阅资料，分析智慧井盖模块若需实现“低电量告警”，需补充哪些硬件（如电压检测模块）与软件逻辑，撰写100字以内小结。|
|参考资料|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|


|教学环节|教学内容|教师活动|学生活动|设计意图|
|---|---|---|---|---|
|课前|预习（30分钟）|1. 在学习平台上传预习视频（含华为云IoT平台注册与实名认证教程、智慧井盖模块数据采集逻辑、`e53_sc_thread`与`iot_cloud_sc_thread`线程分工）；<br>2. 布置预习任务：回顾MQTT客户端初始化流程，思考“为何智慧井盖数据需通过消息队列在 threads间传递”。|1. 观看预习视频，记录疑问（如“华为云产品模型如何定义”）；<br>2. 复习多线程知识，完成预习思考题。|提前铺垫云平台与多线程基础，减少课堂理解障碍，为实操环节打基础。|
|课中|课程介绍（5min）|1. 明确本节课目标：完成华为云IoT平台“智慧井盖”产品与设备配置，实现RK2206开发板采集模块加速度数据（X/Y/Z轴）、判断倾斜告警状态，并上报至华为云平台，同时通过串口查看数据；<br>2. 结合OpenHarmony+华为云在智慧城市中的应用案例，强调国产技术价值，融入思政元素。|1. 记录课堂目标，明确学习重点；<br>2. 聆听应用案例，建立对智慧井盖项目实际意义的认知。|让学生清晰学习方向，以实际场景激发学习兴趣，强化民族自豪感。|
||任务导入（10min）|1. 现场演示：<br> - 登录华为云IoT平台，展示已创建的“智慧井盖”产品与设备，查看历史上报数据；<br> - 连接智慧井盖模块与开发板，烧录代码后按下RESET键，通过串口助手展示“WiFi连接成功、MQTT初始化、2秒采集一次X/Y/Z轴数据、倾斜时LED2亮”的日志；<br> - 倾斜模块，展示华为云平台实时更新的告警状态；<br>2. 拆解核心任务：云平台配置→WiFi与MAC地址修改→代码参数配置→编译烧录→数据验证；<br>3. 强调关键提醒：多人同时开发需修改MAC地址（避免冲突），华为云属性名需与代码完全一致。|1. 观察演示效果，理解任务需求；<br>2. 记录任务拆解步骤，标记云平台与MAC地址配置要点。|通过直观演示降低任务复杂度，以“步骤拆解+关键提醒”帮助学生规避基础错误。|
||知识储备（15min）|1. 讲解核心知识点：<br> - 华为云IoT关键概念：用“身份证”类比（产品=设备类型，设备=具体设备，ClientId/Username/Password=设备认证信息），简化平台逻辑；<br> - 核心API详解：<br>   - `device_info_init(CLIENT_ID, USERNAME, PASSWORD)`：配置华为云设备认证信息，参数需与平台生成的一致；<br>   - `oc_mqtt_init()`：初始化MQTT客户端，返回0表示成功，-1/-2需排查设备信息或网络；<br>   - `oc_mqtt_profile_propertyreport(...)`：按平台产品模型格式上报数据，`payload`需包含X/Y/Z轴与倾斜告警属性；<br> - 倾斜判断逻辑：讲解`DELTA`阈值（如±50），当当前数据与初始值差值超阈值时，标记`tilt_status=1`（告警）并点亮LED2；<br>2. 互动提问：“若`oc_mqtt_init()`返回-1，可能是什么原因？”，引导学生思考设备认证与网络排查方向。|1. 记录API用法与参数含义，结合类比理解云平台逻辑；<br>2. 参与互动，分析初始化失败的可能原因。|聚焦核心API与倾斜判断逻辑，通过类比简化云平台理解，通过提问强化问题排查思维。|
||任务导入（5min）|1. 针对云平台配置补充提问：“华为云创建产品时，服务ID为何必须是‘智慧井盖’？不匹配会有什么问题？”；<br>2. 明确后续重点：讲解MAC地址修改方法（`hwaddr`数组赋值）、WiFi参数（`ROUTE_SSID`/`ROUTE_PASSWORD`）修改路径，以及华为云连接信息（ClientId等）的代码配置位置。|1. 思考并回答提问，理解服务ID与代码的关联；<br>2. 记录MAC地址、WiFi参数修改要点，标记代码路径。|通过提问衔接前序知识，聚焦云平台与代码参数匹配的易错点，提前规避实操问题。|
||知识储备（10min）|1. 代码逻辑拆解：<br> - 多线程与消息队列：分析`iot_cloud_sc_example`函数（创建消息队列→创建两个线程），说明“`e53_sc_thread`采集数据→消息队列暂存→`iot_cloud_sc_thread`上报”的协同逻辑，避免线程资源竞争；<br> - 数据上报流程：讲解`sc_deal_report_msg()`函数如何将采集到的X/Y/Z轴与`tilt_status`封装为华为云要求的格式，调用`oc_mqtt_profile_propertyreport()`上报；<br>2. 用“工厂流水线”类比多线程：`e53_sc_thread`=生产车间（采集数据），消息队列=传送带（传递数据），`iot_cloud_sc_thread`=发货车间（上报云平台）。|1. 分析代码结构，标注线程与消息队列的关键函数；<br>2. 结合“流水线”类比，理解多线程协同逻辑。|用通俗类比降低多线程理解难度，通过代码分析帮助学生掌握核心流程。|
||任务实施（40min）|1. 现场指导：<br> - 云平台指导：巡视学生创建产品（服务ID=“智慧井盖”）、注册设备（密钥认证）、生成连接信息的过程，纠正属性定义错误；<br> - 代码修改指导：协助学生修改MAC地址（如将最后一位改为学号后两位）、WiFi参数、华为云ClientId/Username/Password，检查参数格式；<br> - 异常排查：对“WiFi连不上”的学生检查MAC地址，对“数据不上报”的学生核对华为云属性名与代码一致性；<br>2. 阶段性检查：每完成一个步骤（云平台配置、代码修改、编译烧录），随机抽查进度，确保无学生掉队。|1. 按步骤实操：<br> - 配置华为云：创建产品→定义属性→注册设备→生成连接信息；<br> - 修改代码：配置MAC地址、WiFi参数、华为云认证信息；<br> - 编译烧录，通过串口与华为云平台查看数据；<br>2. 自主排查简单问题（如参数格式错误），复杂问题举手提问。|通过“云平台+代码”双维度指导，提升学生实操与问题解决能力，确保核心任务落地。|
||任务总结（5min）|1. 成果验证：随机邀请2-3名学生展示华为云平台数据与串口日志，确认“X/Y/Z轴数据实时上报、倾斜时告警状态正确”；<br>2. 问题总结：梳理课堂共性问题（如华为云服务ID写错、MAC地址未修改导致WiFi冲突、属性格式不匹配），强调注意事项；<br>3. 检查工单：确认所有学生提交“任务实施工单”（含云平台配置截图、代码参数截图、串口与云平台数据截图）。|1. 展示实操成果，分享问题解决方法（如MAC地址冲突排查）；<br>2. 记录共性问题，补充笔记；<br>3. 提交任务工单，确认成果符合要求。|通过成果展示强化成就感，以问题总结巩固知识点，工单检查确保任务完成质量。|
|作业|学习通练习+实践任务|1. 在学习平台发布作业：线上选择题（10题，含云平台配置、API参数考点）+ 线下实践任务（修改上报周期与新增属性）；<br>2. 提示：线下任务需在3天内上传，教师将批改并反馈拓展思考。|1. 完成线上练习，查看错题解析；<br>2. 开展线下实践，修改代码、验证数据并撰写拓展思考，按时上传。|通过“线上+线下”作业巩固课堂知识，拓展思考提升自主学习与技术分析能力。|
|课后|资源上传与复习|1. 将课堂PPT、实验指导书（含华为云配置步骤、代码模板、MAC地址修改示例、常见问题排查手册）上传至学习平台；<br>2. 汇总学生电子学习档案（含预习情况、工单提交、作业成果），标记需重点辅导的学生；<br>3. 发布复习提示：重点回顾华为云设备认证流程与多线程消息队列协同逻辑。|1. 登录学习平台下载资源，对照笔记补全知识点；<br>2. 查看学习档案，针对薄弱环节（如云平台配置）重点复习；<br>3. 遇到问题可在平台留言提问。|提供全面复习资源，帮助学生查缺补漏，通过档案汇总实现个性化辅导铺垫。|