# 嵌入式操作系统及应用（第28号教案）
|课程名称|嵌入式操作系统及应用|嵌入式操作系统及应用|授课日期||
|---|---|---|---|---|
|班    级|物联网2411|物联网2412|物联网2411|物联网2412|课堂类型|一体化|
|教    材|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|OpenHarmony嵌入式系统原理与应用——基于RK2206芯片|
|章节名称|案例开发：华为云IoT的智慧车载应用|案例开发：华为云IoT的智慧车载应用|案例开发：华为云IoT的智慧车载应用|案例开发：华为云IoT的智慧车载应用|
|目的要求|1. 知识目标：掌握华为云IoT平台“智慧车载”产品创建、设备注册与连接信息配置流程；理解智慧车载模块（E53_IV01）距离采集逻辑（超声波传感器）与告警控制规则（距离≤20cm触发蜂鸣器+警示灯）；熟悉核心API（`device_info_init()`、`oc_mqtt_init()`、`oc_mqtt_profile_propertyreport()`）的调用与参数匹配要求。<br>2. 能力目标：能独立完成华为云IoT平台配置、RK2206开发板WiFi连接与MAC地址修改、智慧车载距离采集与告警控制、数据上报至华为云；能通过串口助手与华为云平台验证数据，排查网络冲突、设备认证及传感器数据异常类问题。<br>3. 素养目标：结合OpenHarmony与华为云的国产技术协同，强化民族自豪感；通过智慧车载“距离告警”在行车安全中的应用，引导学生树立“科技护航安全、技术报国”的情怀。|
|学情分析|1. 基础：学生已熟练掌握华为云IoT平台操作（产品创建、设备注册）、MQTT协议与多线程消息队列逻辑，具备嵌入式传感器模块开发经验，能独立完成编译配置与硬件接线检查。<br>2. 薄弱点：对超声波传感器（E53_IV01）距离计算（`e53_iv01_get_distance()`）的底层时序逻辑理解较浅；对华为云“服务ID-距离属性”与代码参数的精准匹配易忽视；对多人开发时MAC地址冲突导致的WiFi连接失败缺乏系统排查思路，需重点拆解。|
|重 难 点 分    析|1. 重点：<br> - 华为云IoT平台配置（“智慧车载”产品创建时服务ID=“智慧车载”、属性=“距离”，设备注册时密钥认证，连接信息生成与代码配置）；<br> - 智慧车载模块开发全流程（WiFi连接→MAC地址修改→传感器距离采集→告警控制→云平台上报）；<br> - 核心API调用（`device_info_init()`配置ClientId/Username/Password、`oc_mqtt_profile_propertyreport()`上报距离数据）。<br>2. 难点：<br> - 华为云连接信息（ClientId/Username/Password）与代码参数的完全匹配（ mismatch会导致设备认证失败）；<br> - 多线程协同逻辑（`e53_iv_thread`采集距离+控制告警→消息队列传递数据→`iot_cloud_iv_thread`上报云平台）；<br> - 传感器数据异常排查（如E53_IV01未初始化导致距离读取失败、距离≤20cm时告警设备未响应）。|
|信息化应用方法|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|网络教学平台、视频、开发板，开展现场教学，通过项目任务驱动进行混合式教学；|
|思政元素 融合设计|思政元素|融入方式|融入方式|融入方式|
|民族自豪感、科技报国情怀|1. 讲解OpenHarmony与华为云在智能网联汽车领域的技术协同优势（轻量系统适配车载传感器与云端，实现“距离感知-告警-数据上报”闭环），对比国外同类技术方案，强调国产技术对汽车安全领域的支撑作用，强化民族自豪感；<br>2. 结合智慧车载“近距离告警”在倒车防撞、行车安全中的实际价值，引导学生认识嵌入式技术的社会意义，树立“科技护航安全、技术报国”的情怀。|1. 讲解OpenHarmony与华为云在智能网联汽车领域的技术协同优势（轻量系统适配车载传感器与云端，实现“距离感知-告警-数据上报”闭环），对比国外同类技术方案，强调国产技术对汽车安全领域的支撑作用，强化民族自豪感；<br>2. 结合智慧车载“近距离告警”在倒车防撞、行车安全中的实际价值，引导学生认识嵌入式技术的社会意义，树立“科技护航安全、技术报国”的情怀。|1. 讲解OpenHarmony与华为云在智能网联汽车领域的技术协同优势（轻量系统适配车载传感器与云端，实现“距离感知-告警-数据上报”闭环），对比国外同类技术方案，强调国产技术对汽车安全领域的支撑作用，强化民族自豪感；<br>2. 结合智慧车载“近距离告警”在倒车防撞、行车安全中的实际价值，引导学生认识嵌入式技术的社会意义，树立“科技护航安全、技术报国”的情怀。|
|作业布置|1. 线上练习：完成学习通中“华为云IoT智慧车载”相关选择题（含云平台配置、传感器数据采集、API参数考点）；<br>2. 线下实践：修改示例代码，将告警阈值从“距离≤20cm”改为“距离≤30cm”，新增“告警状态”（告警/正常）属性并在华为云添加对应配置，将代码、串口日志与华为云数据截图上传至学习平台；<br>3. 拓展思考：查阅资料，分析智慧车载若需实现“距离数据实时语音播报”，需补充哪些硬件（如语音模块）与软件逻辑，撰写100字以内小结。|
|参考资料|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|1. OpenHarmony嵌入式系统原理与应用——基于RK2206芯片<br>2. https://gitee.com/Lockzhiner-Electronics/lockzhiner-rk2206-openharmony3.0lts.git<br>3. 华为云IoT平台地址：https://www.huaweicloud.com/product/iotdm.html|


|教学环节|教学内容|教师活动|学生活动|设计意图|
|---|---|---|---|---|
|课前|预习（30分钟）|1. 在学习平台上传预习视频（含华为云IoT平台“智慧车载”产品属性定义教程、E53_IV01超声波传感器工作原理、`e53_iv_thread`与`iot_cloud_iv_thread`线程分工）；<br>2. 布置预习任务：回顾消息队列使用流程，思考“为何距离数据需通过消息队列传递给上报线程”。|1. 观看预习视频，记录疑问（如“E53_IV01如何计算距离”）；<br>2. 复习多线程与消息队列知识，完成预习思考题。|提前铺垫云平台、传感器与多线程基础，减少课堂理解障碍，为实操环节打基础。|
|课中|课程介绍（5min）|1. 明确本节课目标：完成华为云IoT平台“智慧车载”产品与设备配置，实现RK2206开发板通过E53_IV01模块采集距离数据、按阈值触发蜂鸣器+警示灯告警，并将距离数据上报至华为云平台，同时通过串口查看数据；<br>2. 结合OpenHarmony+华为云在智能网联汽车中的应用案例，强调国产技术价值，融入思政元素。|1. 记录课堂目标，明确学习重点；<br>2. 聆听应用案例，建立对智慧车载项目实际意义的认知。|让学生清晰学习方向，以实际场景激发学习兴趣，强化民族自豪感。|
||任务导入（10min）|1. 现场演示：<br> - 登录华为云IoT平台，展示已创建的“智慧车载”产品与设备，查看历史距离上报数据；<br> - 连接智慧车载模块与开发板，烧录代码后按下RESET键，通过串口助手展示“WiFi连接成功、MQTT初始化、2秒采集一次距离数据、距离≤20cm时蜂鸣器响+警示灯亮”的日志；<br> - 用物体靠近模块（距离≤20cm），展示告警触发与华为云平台实时更新的距离数据；<br>2. 拆解核心任务：云平台配置→WiFi与MAC地址修改→代码参数配置→编译烧录→数据验证；<br>3. 强调关键提醒：多人同时开发需修改MAC地址（避免WiFi冲突），华为云“距离”属性名需与代码完全一致。|1. 观察演示效果，理解任务需求；<br>2. 记录任务拆解步骤，标记云平台与MAC地址配置要点。|通过直观演示降低任务复杂度，以“步骤拆解+关键提醒”帮助学生规避基础错误。|
||知识储备（15min）|1. 讲解核心知识点：<br> - 华为云IoT关键逻辑：用“车载设备身份证”类比（产品=车载设备型号，设备=具体车载终端，ClientId/Username/Password=身份认证信息），简化平台配置逻辑；<br> - 核心API详解：<br>   - `device_info_init(CLIENT_ID, USERNAME, PASSWORD)`：配置华为云设备认证信息，参数需与平台生成的一致，否则认证失败；<br>   - `oc_mqtt_init()`：初始化MQTT客户端，返回0为成功，-1/-2需排查设备信息或网络；<br>   - `oc_mqtt_profile_propertyreport(...)`：按平台产品模型格式上报距离数据，`payload`需包含“距离”属性字段；<br> - 距离控制逻辑：讲解E53_IV01传感器数据读取（`e53_iv01_get_distance()`返回浮点型距离值）与阈值判断（≤20cm调用`e53_iv01_buzzer_set(1)`+`e53_iv01_led_warning_set(1)`触发告警）；<br>2. 互动提问：“若`oc_mqtt_profile_propertyreport()`返回失败，可能是什么原因？”，引导学生思考属性格式与云平台匹配问题。|1. 记录API用法与参数含义，结合类比理解云平台逻辑；<br>2. 参与互动，分析数据上报失败的可能原因。|聚焦核心API与距离控制逻辑，通过类比简化云平台理解，通过提问强化问题排查思维。|
||任务导入（5min）|1. 针对传感器与代码补充提问：“`e53_iv01_init()`函数的作用是什么？不调用会导致什么问题？”；<br>2. 明确后续重点：讲解MAC地址修改方法（`hwaddr`数组最后一位改为学号后两位）、WiFi参数（`ROUTE_SSID`/`ROUTE_PASSWORD`）修改路径，以及华为云连接信息在代码中的配置位置。|1. 思考并回答提问，理解传感器初始化的必要性；<br>2. 记录MAC地址、WiFi参数修改要点，标记代码路径。|通过提问衔接前序知识，聚焦传感器初始化与参数配置易错点，提前规避实操问题。|
||知识储备（10min）|1. 代码逻辑拆解：<br> - 多线程与消息队列：分析`iot_cloud_iv_example`函数（创建消息队列→创建两个线程），说明“`e53_iv_thread`采集距离+控告警→消息队列暂存数据→`iot_cloud_iv_thread`上报云平台”的协同逻辑，避免线程资源竞争；<br> - 距离数据流程：讲解`iv_deal_report_msg()`函数如何将采集到的距离值封装为华为云要求的格式，调用`oc_mqtt_profile_propertyreport()`上报；<br>2. 用“车载数据处理流水线”类比多线程：`e53_iv_thread`=感知车间（采集距离+触发告警），消息队列=数据传送带，`iot_cloud_iv_thread`=云端上报车间。|1. 分析代码结构，标注线程与消息队列的关键函数；<br>2. 结合“流水线”类比，理解多线程协同逻辑。|用通俗类比降低多线程理解难度，通过代码分析帮助学生掌握核心流程。|
||任务实施（40min）|1. 现场指导：<br> - 云平台指导：巡视学生创建产品（服务ID=“智慧车载”）、注册设备（密钥认证）、生成连接信息的过程，纠正属性名错误；<br> - 代码修改指导：协助学生修改MAC地址（如`hwaddr[5] = 0x02`）、WiFi参数，检查华为云ClientId/Username/Password的代码配置；<br> - 异常排查：对“WiFi连不上”的学生检查MAC地址，对“距离读取失败”的学生排查模块接线，对“数据不上报”的学生核对华为云属性格式；<br>2. 阶段性检查：每完成一个步骤（云平台配置、代码修改、编译烧录），随机抽查进度，确保无学生掉队。|1. 按步骤实操：<br> - 配置华为云：创建产品→定义“距离”属性→注册设备→生成连接信息；<br> - 修改代码：配置MAC地址、WiFi参数、华为云认证信息；<br> - 编译烧录，通过串口与华为云平台验证距离数据与告警控制；<br>2. 自主排查简单问题（如参数格式错误），复杂问题举手提问。|通过“云平台+代码+硬件”三维度指导，提升学生实操与问题解决能力，确保核心任务落地。|
||任务总结（5min）|1. 成果验证：随机邀请2-3名学生展示华为云平台数据与串口日志，确认“距离数据实时上报、阈值控制告警正确”；<br>2. 问题总结：梳理课堂共性问题（如华为云服务ID写错、MAC地址未修改导致WiFi冲突、属性格式不匹配），强调注意事项；<br>3. 检查工单：确认所有学生提交“任务实施工单”（含云平台配置截图、代码参数截图、串口与云平台数据截图）。|1. 展示实操成果，分享问题解决方法（如MAC地址冲突排查）；<br>2. 记录共性问题，补充笔记；<br>3. 提交任务工单，确认成果符合要求。|通过成果展示强化成就感，以问题总结巩固知识点，工单检查确保任务完成质量。|
|作业|学习通练习+实践任务|1. 在学习平台发布作业：线上选择题（10题，含云平台配置、传感器采集、API参数考点）+ 线下实践任务（修改告警阈值与新增属性）；<br>2. 提示：线下任务需在3天内上传，教师将批改并反馈拓展思考。|1. 完成线上练习，查看错题解析；<br>2. 开展线下实践，修改代码、验证数据并撰写拓展思考，按时上传。|通过“线上+线下”作业巩固课堂知识，拓展思考提升自主学习与技术分析能力。|
|课后|资源上传与复习|1. 将课堂PPT、实验指导书（含华为云配置步骤、代码模板、MAC地址修改示例、E53_IV01模块接线图、常见问题排查手册）上传至学习平台；<br>2. 汇总学生电子学习档案（含预习情况、工单提交、作业成果），标记需重点辅导的学生；<br>3. 发布复习提示：重点回顾华为云设备认证流程与多线程消息队列协同逻辑。|1. 登录学习平台下载资源，对照笔记补全知识点；<br>2. 查看学习档案，针对薄弱环节（如云平台配置、传感器接线）重点复习；<br>3. 遇到问题可在平台留言提问。|提供全面复习资源，帮助学生查缺补漏，通过档案汇总实现个性化辅导铺垫。|